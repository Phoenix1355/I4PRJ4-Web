<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/index.vue</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/index.vue</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;template>
    &lt;Container>
        &lt;h1>Turoversigt&lt;/h1>
        &lt;div v-if="loggedIn">
            &lt;p>Velkommen, {{ name }}&lt;/p>
            &lt;p
                v-if="errorMessage !== ''"
                class="error"
            >
                {{ errorMessage }}
            &lt;/p>
            &lt;ul
                v-if="items.length > 0"
                class="rides"
            >
                &lt;li
                    v-for="item in items"
                    :key="item.id"
                    class="item"
                >
                    &lt;div class="item-group">
                        &lt;small>Start&lt;/small>
                        &lt;p>{{ displayLocation(item.startDestination) }}&lt;/p>
                    &lt;/div>
                    &lt;div class="item-group">
                        &lt;small>Slut&lt;/small>
                        &lt;p>{{ displayLocation(item.endDestination) }}&lt;/p>
                    &lt;/div>
                    &lt;div class="item-group">
                        &lt;small>Tidspunkt&lt;/small>
                        &lt;p>{{ item.departureTime.format("D MMM YYYY, HH:mm") }}&lt;/p>
                    &lt;/div>
                    &lt;div class="item-group">
                        &lt;small>Pris&lt;/small>
                        &lt;p>{{ item.price }} DKK&lt;/p>
                    &lt;/div>
                &lt;/li>
            &lt;/ul>
            &lt;p
                v-else
                align="center"
            >
                &lt;i>Henter de seneste ture...&lt;/i>
            &lt;/p>
            &lt;p>
                &lt;Button
                    :on-click="logout"
                >
                    Logout
                &lt;/Button>
            &lt;/p>
        &lt;/div>
    &lt;/Container>
&lt;/template>

&lt;script>
import Moment from 'moment';

import { fetchOpenRides } from '../api';
import { displayLocation } from '../utils';
import Container from '../components/Container.vue';
import Button from '../components/Button.vue';

/**
 * The main page displaying the rides. The client must be logged in to see this
 * page, because of the 'auth' middleware.
 *
 * @module Pages/Index
 *
 * @vue-data {Array} items - The list of retrieved items
 * @vue-data {String} errorMessage - The latest error message
 * @vue-data {Function} interval - THe interval loop used to call retrieve event
 *
 * @vue-computed {String} name - Returns the name of the current state account
 * @vue-computed {Bool} loggedIn - Return the login status from the current state
 *
 * @vue-event {} logout - The logout method dispatching 'logout' to the store
 * @vue-event {Array} retrieve - retrieves open rides from backend
 */
export default {
    middleware: 'auth',
    components: {
        Button,
        Container,
    },

    data: () => ({
        items: [],
        errorMessage: '',
        interval: null,
    }),

    computed: {
        name() {
            // return this.$store.state.auth.user.name || 'temp';
            return 'temp';
        },
        loggedIn() {
            return this.$store.state.auth.token != null;
        },
    },

    /**
     * Creation lifecycle hook
     *
     * Initializes an interval which calls the retrieve event every 5 seconds.
     *
     * @memberOf Pages/Index
     */
    created() {
        // Retrieve first on creation
        this.retrieve();

        // Then retrieve every 5 seconds
        this.interval = setInterval(() => this.retrieve(), 5000);
    },

    methods: {
        // Import displayLocation method for view use
        displayLocation,

        logout() {
            this.$store.dispatch('logout')
                .then(() => this.$router.push('/login'));
        },

        retrieve() {
            return fetchOpenRides(this.$store.state.auth.token)
                .then((res) => {
                    console.log(res);
                    if (res.data.length === 0) {
                        this.errorMessage = 'List is empty';
                        return;
                    }

                    this.items = res.data.orders.map(item => ({
                        startDestination: item.rides[0].startDestination,
                        endDestination: item.rides[item.rides.length - 1].endDestination,
                        departureTime: new Moment(item.rides[0].departureTime),
                        price: item.price,
                    }));
                });
        },
    },
};
&lt;/script>

&lt;style lang="scss">
@import '../styles/helpers.scss';

.rides {
    padding: 0;
    margin: 20px 0;

    list-style: none;
}

.rides .item {
    display: grid;
    grid-template-columns: 1fr 1fr 170px 120px;
    width: 100%;
    padding: 10px 0;

    border-bottom: 1px solid #DDD;

    @include bp(hg) {
        grid-template-columns: 1fr 1fr 200px 120px;
    }

    .item-group {

        small {
            color: rgba($black, 0.5);
        }

        p {
            margin: 0;
        }
    }
}

.error {
    color: red;
}

&lt;/style>
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Components_Button.html">Components/Button</a></li><li><a href="module-Components_Container.html">Components/Container</a></li><li><a href="module-Pages_Index.html">Pages/Index</a></li><li><a href="module-Pages_Login.html">Pages/Login</a></li></ul><h3>Global</h3><ul><li><a href="global.html#displayLocation">displayLocation</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Apr 30 2019 15:07:31 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
